# Удаление дублирующей команды "Умножить на 1"

## 0. Метаданные
- Тип (профиль): Исправление (bugfix/refactoring)
- Владелец: команда MathHelper
- Масштаб: small
- Целевой релиз / ветка: текущая ветка
- Ограничения: использовать существующие файлы проекта; не писать код до утверждения спеки
- Связанные ссылки: specs/2026-01-16-operations-availability.md

## 1. Overview / Цель
Удалить команду "Умножить на 1" (`multiply_by_one`), так как она полностью дублируется командой "Добавить *1" (`ADD_MULTIPLYING_BY_ONE`).

## 2. Текущее состояние (AS-IS)
В системе присутствуют две идентичные команды для добавления множителя 1:
1. `ADD_MULTIPLYING_BY_ONE` (отображается как "Добавить *1"):
   - Реализована как кастомная операция в `MathStepsEngine.listOps`.
   - Использует `MathStepsEngine.getDescription('ADD_MULTIPLYING_BY_ONE')`.
   - Покрыта E2E тестами.
2. `multiply_by_one` (отображается как "+ Умножить на 1"):
   - Реализована как legacy-правило в `getLegacyApplicableRules`.
   - Имеет собственную функцию применения `multiplyByOne`.

## 3. Проблема
Дублирование функционала в UI сбивает пользователя с толку и усложняет поддержку кода.

## 4. Цели дизайна
- Устранение дублирования.
- Сохранение функциональности "Добавить *1", которая является более современной (кастомная операция).
- Очистка кода от неиспользуемых legacy-функций.

## 5. Non-Goals (чего НЕ делаем)
- Не меняем логику работы `ADD_MULTIPLYING_BY_ONE`.
- Не затрагиваем другие legacy-правила, если они не дублируются.

## 6. Предлагаемое решение (TO-BE)
### 6.1 Распределение ответственности
- `MathStepsEngine`:
  - Удалить регистрацию правила `multiply_by_one` в `getLegacyApplicableRules`.
  - Удалить вспомогательную функцию `multiplyByOne`.

### 6.2 Детальный дизайн
1. В файле `src/core/mathsteps-engine.ts` найти функцию `getLegacyApplicableRules`.
2. Удалить блок кода, добавляющий правило `multiply_by_one`.
3. Найти и удалить функцию `multiplyByOne`.

## 7. Бизнес-правила / Алгоритмы (если есть)
Нет изменений в логике.

## 8. Точки интеграции и триггеры
- `MathStepsEngine.listOps` — больше не будет вызывать `multiply_by_one` через `listLegacyRuleOps`.

## 9. Изменения модели данных / состояния
Нет изменений.

## 10. Миграция / Rollout / Rollback
- Обратная совместимость: команда "Добавить *1" остается доступной под тем же ID (`custom:ADD_MULTIPLYING_BY_ONE:...`).
- План отката: восстановить удаленный код.

## 11. Тестирование и критерии приёмки
### Acceptance Criteria
- В панели команд при выборе любого выражения отображается только одна команда добавления множителя 1 — "Добавить *1".
- Команда "+ Умножить на 1" отсутствует.
- Команда "Добавить *1" работает корректно (как и прежде).

### Тесты
1. Запустить существующие unit-тесты: `npm run test:run`.
2. Запустить существующие E2E тесты: `npm run test:e2e:with-dev`.
3. Убедиться, что E2E тесты, проверяющие `ADD_MULTIPLYING_BY_ONE`, проходят успешно.

## 12. Риски и edge cases
- Если какие-то части системы или старые сохраненные сессии полагались именно на ID `LEGACY_multiply_by_one`, они перестанут работать. Однако, учитывая недавний переход на AST-рендер и кастомные операции, риск минимален.

## 13. План выполнения
1. Удалить регистрацию `multiply_by_one` в `src/core/mathsteps-engine.ts`.
2. Удалить функцию `multiplyByOne` в `src/core/mathsteps-engine.ts`.
3. Проверить проект на наличие других упоминаний `multiply_by_one` и удалить их при необходимости.
4. Запустить все тесты.

## 14. Открытые вопросы
Нет.

## 15. Результат прогона линтера
(Чеклист из SPEC-LINTER.md)
- [x] Спека описывает удаление дубликата? Да.
- [x] Указаны конкретные ID операций? Да.
- [x] Проверено влияние на тесты? Да.

## Approval
Ожидается фраза: "Спеку подтверждаю"
