# Спецификация: правила преобразования выражений (Quest Mode)

## Контекст
Требуется добавить возможность применять правила преобразования вручную через панель команд, доступных после выбора подвыражения. Автоматическое применение правил не допускается.

## 1. Набор правил (двунаправленные, обобщённые формы)

### 1.1 Дистрибутивность
- `(a + b + ...)*c  <->  a*c + b*c + ...`
- `a*(b + c + ...)  <->  a*b + a*c + ...`

### 1.2 Факторизация
- `a*b + a*c + ...  <->  a*(b + c + ...)`
- `a*c + b*c + ...  <->  (a + b + ...)*c`

### 1.3 Знак
- `a + (-b)  <->  a - b`
- `a - b  <->  a + (-b)`

Где `a, b, c, ...` — произвольные подвыражения, а сумма содержит минимум 2 слагаемых.

## 2. Применение правил
- Преобразования выполняются **только вручную** через панель команд.
- Команды доступны **только** для выбранного подвыражения.
- Никаких фоновых/автоматических преобразований.

## 3. Правила сопоставления (обобщённые)
- Для дистрибутивности: один множитель — сумма из **2+** слагаемых.
- Для факторизации: сумма, где все слагаемые имеют **общий множитель** слева или справа.

## 4. Скобки при появлении `+` в результате
Если в результате преобразования **внутри подвыражения появляется `+`**, то это подвыражение **обязательно** оборачивается в скобки, **если слева или справа от него есть `*` или `/`**.

Пример:
- `y*a*(b+c)*x -> y*(a*b+a*c)*x`  
  Скобки обязательны, чтобы сохранить корректный приоритет операций.

## 5. Ограничения
- Ограничений на рост выражения нет.
- Направление преобразования выбирается пользователем через команду.
